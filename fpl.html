<!DOCTYPE html>
<html lang="en">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NK02K5SZ2M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NK02K5SZ2M');
</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WF8B5XZ');</script>
  <!-- End Google Tag Manager -->
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="Eloy Chang" />
        <title>Epsilon DL - FPL</title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.1/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
      <!-- Google Tag Manager (noscript) -->
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WF8B5XZ"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      <!-- End Google Tag Manager (noscript) -->
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
            <div class="container">
                <a class="navbar-brand js-scroll-trigger" href="#page-top">Eloy Chang</a>
                <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="index.html#masthead">Home</a></li>
                        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="index.html#about">About</a></li>
                        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="index.html#latest">Lastest</a></li>
                        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="index.html#projects">Projects</a></li>
                        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="index.html#signup">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Masthead-->
        <header class="fpl_masthead">
            <div class="container d-flex h-100 align-items-center">
                <div class="mx-auto text-center">
                    <h1 class="mx-auto my-0 text-uppercase">Fantasy Premier League</h1>
                    <h2 class="text-white-50 mx-auto mt-2 mb-5">I have played the FPL for over 5 seasons, each decision were more passionate than logical, now I'm changing this, using the power of data.</h2>
                </div>
            </div>
        </header>
        <!-- Post section-->
        <!--<section>-->
          <div class="container_post">
            <h1>FPL API - Matchweek stat Dashboard</h1>
            <h2>Introduction to FPL</h2>
            <p class="text-black-50 mb-0">The Fantasy Premier League (FPL) is a very popular game, our job, as players, is to build a team with Premier League teams players, filling all position, goalkeepers, defense, midfielders and forwards, and even the bench, all with a starting budget of £100, other rules apply as, no more of 3 players from the same team, and we need a specific number of player of each position. </p>
            <p class="text-black-50 mb-0">Previous to each matchweek, we may make a transfer, if we want to make more than one we will suffer a points penalty. We also need to selec the formation and which player will play and which will be benched, also the captain (who gets double points).</p>
            <p class="text-black-50 mb-0">Then, with each game the player gets points, based on what they accomplished, like goals, assists, clean sheets, etc. Finally we sum all points our team makes.</p>
            <p class="text-black-50 mb-0">It’s an easy game, but is really fun and addictive, and of course, there are a lot of things we can use to optimize our score using data. I recently discovered the official API of the game, with a lot of very interesting data in real time.</p>
            <br></br>
            <h2>FPL API</h2>
            <p class="text-black-50 mb-0">I used python to extract and process the data, in this article I will just extract, but later i’ll post some nice projects I have in mind.</p>
            <p class="text-black-50 mb-0">For downloading the data we will need 2 library, <a href="https://pypi.org/project/requests/">requests</a> and <a href="https://pandas.pydata.org/">pandas</a>.</p>
            <sup class="text-black-55 mb-0"><b>import requests</b></sup><br>
            <sup class="text-black-55 mb-0"><b>import pandas as pd</b></sup>
            <p class="text-black-50 mb-0">Now let's set the api url, and make the call</p>
            <sup class="text-black-55 mb-0"><b>url = 'https://fantasy.premierleague.com/api/bootstrap-static/'</b></sup><br>
            <sup class="text-black-55 mb-0"><b>r = requests.get(url)</b></sup><br>
            <sup class="text-black-55 mb-0"><b>json = r.json()</b></sup>
            <p class="text-black-50 mb-0">With these lines we get a python dictionary (variable json) with all the data from the API, those are 8 main sets.</p>
            <p class="text-black-50 mb-0">To create a pandas data frame with one of this sets we can use:</p>
            <sup class="text-black-55 mb-0"><b>elements = pd.DataFrame(json['elements'])</b></sup>
            <br></br>
            <h3>Events</h3>
            <p class="text-black-50 mb-0">This has the information of the matchweeks (or gameweeks) like most selected player, best player, average and highest team score, etc. The variables in this set are:</p>
            <b class="text-black-50 mb-0">['id', 'name', 'deadline_time', 'average_entry_score', 'finished',  'data_checked', 'deadline_time_game_offset', 'highest_score', 'is_previous',  'is_current', 'is_next', 'chip_plays', 'most_selected', 'most_transferred_in', 'top_element', 'top_element_info', 'transfers_made', 'most_captained', 'most_vice_captained']</b>
            <br></br>
            <h3>Game Settings</h3>
            <p class="text-black-50 mb-0">This has information about the rules of the game, size of each squad and other stuff. This one cannot be converted into a data frame, but we will not use it anyway.</p>
            <br></br>
            <h3>Phases</h3>
            <p class="text-black-50 mb-0">Informatión about each phase of the game, each phase is a month, useful for track phase performance. The variables in this set are:</p>
            <b class="text-black-50 mb-0">['id', 'name', 'start_event', 'stop_event']</b>
            <br></br>
            <h3>Teams</h3>
            <p class="text-black-50 mb-0">This has the information and stats of each premier league team. The variables in this set are:</p>
            <b class="text-black-50 mb-0">['code', 'draw', 'form', 'id', 'loss', 'name', 'played', 'points', 'position', 'short_name', 'strength', 'team_division', 'unavailable', 'win', 'strength_overall_home', 'strength_overall_away', 'strength_attack_home', 'strength_attack_away', 'strength_defence_home', 'strength_defence_away', 'pulse_id']</b>
            <br></br>
            <h3>Total Players</h3>
            <p class="text-black-50 mb-0">This is just how many players (users) are in the game.</p>
            <br></br>
            <h3>Elements</h3>
            <p class="text-black-50 mb-0">This is the most important set, with all information and stats of each player in the premier league, there are a bunch of columns like name, last gameweek points, total points, value, goals, assists, minutes played, etc.  The variables in this set are:</p>
            <b class="text-black-50 mb-0">['chance_of_playing_next_round', 'chance_of_playing_this_round', 'code', 'cost_change_event', 'cost_change_event_fall', 'cost_change_start',  'cost_change_start_fall', 'dreamteam_count', 'element_type', 'ep_next', 'ep_this', 'event_points', 'first_name', 'form', 'id', 'in_dreamteam', 'news', 'news_added', 'now_cost', 'photo', 'points_per_game', 'second_name', 'selected_by_percent', 'special', 'squad_number', 'status', 'team', 'team_code', 'total_points', 'transfers_in', 'transfers_in_event', 'transfers_out', 'transfers_out_event', 'value_form', 'value_season', 'web_name', 'minutes', 'goals_scored', 'assists', 'clean_sheets', 'goals_conceded', 'own_goals', 'penalties_saved', 'penalties_missed', 'yellow_cards', 'red_cards', 'saves', 'bonus', 'bps', 'influence', 'creativity', 'threat', 'ict_index', 'influence_rank', 'influence_rank_type', 'creativity_rank', 'creativity_rank_type', 'threat_rank', 'threat_rank_type', 'ict_index_rank', 'ict_index_rank_type', 'corners_and_indirect_freekicks_order', 'corners_and_indirect_freekicks_text', 'direct_freekicks_order', 'direct_freekicks_text', 'penalties_order', 'penalties_text']</b>
            <br></br>
            <h3>Elements Stats</h3>
            <p class="text-black-50 mb-0">These are just human readable names of each stat saved for the players. The variables in this set are:</p>
            <b class="text-black-50 mb-0">['label', 'name']</b>
            <br></br>
            <h3>Elements Types</h3>
            <p class="text-black-50 mb-0">The definition of each position for players, those are: goalkeeper, defenders, midfielders and forwards. The variables in this set are:</p>
            <b class="text-black-50 mb-0">['id', 'plural_name', 'plural_name_short', 'singular_name', 'singular_name_short', 'squad_select', 'squad_min_play', 'squad_max_play', 'ui_shirt_specific', 'sub_positions_locked', 'element_count']</b>
            <br></br>
            <h3>Others</h3>
            <p class="text-black-50 mb-0">There are other sets with different endpoints of the API, but we will not use it in this post.</p>
            <br></br>
            <h2>Downloading the Data</h2>
            <p class="text-black-50 mb-0">For this post we just want to make a descriptive dashboard of the last gameweek, so we will extract the elements set and replace the team id and position.</p>
            <p class="text-black-50 mb-0">The code is:</p>
            <sup class="text-black-55 mb-0"><b>url = 'https://fantasy.premierleague.com/api/bootstrap-static/'</b></sup><br>
            <sup class="text-black-55 mb-0"><b>r = requests.get(url)</b></sup><br>
            <sup class="text-black-55 mb-0"><b>json = r.json()</b></sup><br><br>

            <sup class="text-black-55 mb-0"><b>elements = pd.DataFrame(json['elements'])</b></sup><br>
            <sup class="text-black-55 mb-0"><b>elements["value_season"] = elements.value_season.astype(float)</b></sup><br>
            <sup class="text-black-55 mb-0"><b>elements["total_points"] = elements.total_points.astype(int)</b></sup><br>
            <sup class="text-black-55 mb-0"><b>elements["cost"] = elements.total_points / elements.value_season</b></sup><br><br>

            <sup class="text-black-55 mb-0"><b>elements_types = pd.DataFrame(json['element_types'])[["id", "singular_name"]].set_index("id")</b></sup><br>
            <sup class="text-black-55 mb-0"><b>elements["position"] = elements.element_type.map(elements_types.singular_name)</b></sup><br>
            <sup class="text-black-55 mb-0"><b>elements.drop(columns = "element_type", inplace = True)</b></sup><br>
            <sup class="text-black-55 mb-0"><b>teams = pd.DataFrame(json['teams'])[["id", "name"]].set_index("id")</b></sup><br>
            <sup class="text-black-55 mb-0"><b>elements["team"] = elements.team.map(teams.name)</b></sup>
            <p class="text-black-50 mb-0">Now to save it we use the datetime library to get the date and use it in the name of the file, in this case a csv file.</p>
            <sup class="text-black-55 mb-0"><b>elements.to_csv("data/tableau_{}.csv".format(datetime.now().strftime("%Y%m%d")), index = False, sep = ";")</b></sup>
            <p class="text-black-50 mb-0">Finally we use Tableau Public to make our dashboard, here is the results:</p>
            <br></br>

            <div class='tableauPlaceholder' id='viz1615757416923' style='position: relative'><noscript><a href='https:&#47;&#47;echang1802.github.io&#47;epsilon.github.io&#47;'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Fa&#47;FantasyPremierLeague_16157556653850&#47;MatchweekStats&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='FantasyPremierLeague_16157556653850&#47;MatchweekStats' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Fa&#47;FantasyPremierLeague_16157556653850&#47;MatchweekStats&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='language' value='es' /><param name='filter' value='publish=yes' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1615757416923');                    var vizElement = divElement.getElementsByTagName('object')[0];                    if ( divElement.offsetWidth > 800 ) { vizElement.style.width='1024px';vizElement.style.height='795px';} else if ( divElement.offsetWidth > 500 ) { vizElement.style.width='1024px';vizElement.style.height='795px';} else { vizElement.style.width='100%';vizElement.style.height='2177px';}                     var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
          </div>

        <!-- Contact-->
        <section class="signup-section" id="signup">
                <div class="container">
                    <div class="row">
                        <div class="col-md-4 mb-3 mb-md-0">
                            <div class="card py-4 h-100">
                                <div class="card-body text-center">
                                    <i class="fab fa-linkedin"></i></a>
                                    <h4 class="text-uppercase m-0">LinkedIn</h4>
                                    <hr class="my-4" />
                                    <div class="small text-black-50"><a href="https://www.linkedin.com/in/echang182/">echang182</a></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3 mb-md-0">
                            <div class="card py-4 h-100">
                                <div class="card-body text-center">
                                    <i class="fab fa-github"></i></a>
                                    <h4 class="text-uppercase m-0">GitHub</h4>
                                    <hr class="my-4" />
                                    <div class="small text-black-50"><a href="https://github.com/echang1802">echang1802</a></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3 mb-md-0">
                            <div class="card py-4 h-100">
                                <div class="card-body text-center">
                                    <img src="assets/img/tableau-icon.png" alt="" weight="15" height="15"/>
                                    <h4 class="text-uppercase m-0">Tableau</h4>
                                    <hr class="my-4" />
                                    <div class="small text-black-50"><a href="https://public.tableau.com/profile/eloy.chang#!/?newProfile=&activeTab=0">Eloy Chang</a></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </section>
        <!-- Footer-->
        <footer class="footer bg-black small text-center text-white-50"><div class="container">Epsilon DataLabs - Made by Eloy Chang with GitHub pages and Start Bootstrap</div></footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Third party plugin JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
